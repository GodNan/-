webpackJsonp([63],{KatS:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("Dd8w"),a=s.n(r),i=s("NYxO"),o=s("rLcC"),n=s("5u+E"),l=s("zHhc"),d=s("jSlZ"),u=s("Q3je"),c=["视力","听力","言语","肢体","智力","精神"],p={components:{Citizen:o.default,TasksLog:n.default,OperLog:l.default},data:function(){var e=this;return{isLoading:!1,isSubmitting:!1,activeStep:4,activeName:"citizen",steps:[],backSteps:[],requestNote:{requestId:this.$route.params.requestId,userId:this.$store.getters.userId,userName:this.$store.getters.nickname,note:"",handleState:this.$store.getters.handleState,finishState:0,handleType:"",backState:""},requestStakeholder:{requestId:this.$route.params.requestId,userId:"",cityid:this.$store.getters.cityid+"%",permissionId:"",delFlag:0},dtoState:{processId:this.$store.getters.processId,stateType:3,stateCode:0},rules:{handleType:[{required:!0,message:"请选择处理结果",trigger:"change"}],backState:[{validator:function(t,s,r){2===e.requestNote.handleType&&""===s&&r(new Error("请选择回退节点!")),r()},trigger:"change"}],note:[{validator:function(t,s,r){""!==e.requestNote.handleType&&1!==e.requestNote.handleType&&""===s&&r(new Error("请填写处理意见!")),r()},trigger:"blur"}]}}},computed:a()({},Object(i.b)(["kindstr","guardianOrAgent","isGongan","dict","isHulian","processId"]),{couldReturn:function(){return 219===this.requestNote.handleState},processName:function(){var e=this;return this.dict.processList.filter(function(t){return parseInt(t.code,10)===e.$store.getters.processId})[0].description+" :"},kindstrApply:function(){var e=this.$store.getters.kindstr;if(""===e||null===e||void 0===e)return"";if(e.indexOf(",")<0)return"";for(var t=e.split(","),s="",r=0;r<t.length;r++)","!==t[r]&&""!==t[r]&&(s+=c[parseInt(t[r],10)-1]+" ");return s}}),watch:{steps:function(e){var t=this;"tasksTodoApplyHandleIdtReject"===this.$route.name&&e.length>0&&(18!==this.$store.getters.processId&&58!==this.$store.getters.processId||(this.activeStep=this.steps.find(function(e){return e.stateCode===t.$store.getters.handleState}).orderNum-1),this.getBackSteps())},"requestNote.backState":function(e){var t=this;""!==e&&(this.requestNote.finishState=e,this.requestStakeholder.permissionId=this.steps.find(function(e){return e.stateCode===t.requestNote.finishState}).permissionId)}},created:function(){this.getSteps()},methods:{submit:function(){var e=this;this.isSubmitting=!0,this.$refs.handle.validate(function(t){if(!t)return e.isSubmitting=!1,!1;e.handleBusiness()})},handleBusiness:function(){var e=this,t={requestNote:this.requestNote,requestStakeholder:this.requestStakeholder,processId:this.$store.getters.processId};Object(u.b)(t).then(function(t){e.$router.push({name:"tasksTodoList"})})},handleClick:function(e,t){this.$refs["idt"+e.name].loaded||this.$refs["idt"+e.name].getIdtInfo(),"operlog"===e.name&&this.$refs.idtoperlog.getIdtInfo()},getSteps:function(){var e=this;this.isLoading=!0,this.dtoState.stateType=3,Object(d.c)(this.dtoState).then(function(t){e.isLoading=!1,e.steps=t.data.sort(function(e,t){return e.orderNum-t.orderNum})})},getBackSteps:function(){var e=this;this.dtoState.stateType=1,this.dtoState.orderNum=this.activeStep+1,Object(d.a)(this.dtoState).then(function(t){e.backSteps=t.data.filter(function(e){return e.orderNum>1}),e.backSteps=e.backSteps.filter(function(e){return 217!==e.stateCode})})}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[this.$route.params.handle&&1===e.isGongan?s("el-card",["tasksTodoApplyHandleIdtReject"===this.$route.name?s("el-form",{directives:[{name:"loading",rawName:"v-loading.body",value:e.isLoading,expression:"isLoading",modifiers:{body:!0}}],ref:"handle",attrs:{model:e.requestNote,rules:e.rules,size:"medium","label-position":"left","label-width":"85px","element-loading-text":"加载中"}},[s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:e.processName,"label-width":"170px"}},[18===e.processId||58===e.processId?s("el-steps",{attrs:{active:e.activeStep}},e._l(e.steps,function(e){return s("el-step",{key:e.stateCode,attrs:{title:e.name,icon:e.icon}})})):e._e()],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("el-form-item",{attrs:{label:"处理结果:",prop:"handleType"}},[s("el-radio-group",{model:{value:e.requestNote.handleType,callback:function(t){e.$set(e.requestNote,"handleType",t)},expression:"requestNote.handleType"}},[e.couldReturn?s("el-radio",{attrs:{label:2}},[e._v("驳回")]):e._e()],1)],1)],1),e._v(" "),2===e.requestNote.handleType?s("el-col",{attrs:{span:4}},[s("el-form-item",{attrs:{"label-width":"2px",prop:"backState"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.requestNote.backState,callback:function(t){e.$set(e.requestNote,"backState",t)},expression:"requestNote.backState"}},e._l(e.backSteps,function(e){return s("el-option",{key:e.stateCode,attrs:{label:e.name,value:e.stateCode}})}))],1)],1):e._e()],1),e._v(" "),s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"处理意见:",prop:"note"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.requestNote.note,callback:function(t){e.$set(e.requestNote,"note",t)},expression:"requestNote.note"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:"申请类别:"}},[s("el-alert",{attrs:{title:e.kindstrApply,type:"error",closable:!1}})],1)],1),e._v(" "),s("el-col",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.isSubmitting,expression:"isSubmitting",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":"操作处理中"}})],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{"label-width":"0"}},[e.isSubmitting?e._e():s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.submit}},[e._v("提交")])],1)],1)],1)],1):e._e()],1):e._e(),e._v(" "),s("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"基本信息",name:"citizen"}},[s("citizen",{ref:"idtcitizen",attrs:{idt:"",info:"",mark:this.$route.params.cdpfId}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"任务历史",name:"taskslog"}},[s("tasks-log",{ref:"idttaskslog",attrs:{mark:this.$route.params.requestId}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"操作历史",name:"operlog"}},[s("oper-log",{ref:"idtoperlog",attrs:{mark:this.$route.params.cdpfId}})],1)],1)],1)},staticRenderFns:[]},m=s("VU/8")(p,h,!1,null,null,null);t.default=m.exports}});